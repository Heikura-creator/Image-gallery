<!doctype html>
<html lang="en" data-bs-theme="light">
<head>
  <meta charset="UTF-8">
  <title>Image Gallery</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

  <style>
    .fade-in {
      opacity: 0;
      transform: translateY(20px);
      animation: fadeInUp 0.6s ease forwards;
    }

    @keyframes fadeInUp {
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .fade-delay-1 { animation-delay: 0.1s; }
    .fade-delay-2 { animation-delay: 0.2s; }
    .fade-delay-3 { animation-delay: 0.3s; }
    .fade-delay-4 { animation-delay: 0.4s; }

    body.light-mode {
      background-color: #f8f9fa;
      color: #212529;
    }

    body.dark-mode {
      background-color: #121212;
      color: #f8f9fa;
    }

    .card.dark-mode {
      background-color: #1e1e1e;
      border-color: #333;
    }

    .card.light-mode {
      background-color: #ffffff;
      border-color: #dee2e6;
    }

    .delete-btn {
      position: absolute;
      top: 0.5rem;
      right: 0.5rem;
      opacity: 0;
      transition: opacity 0.3s ease;
      z-index: 10;
    }

    .card:hover .delete-btn {
      opacity: 1;
    }
  </style>

  <script>
    function applyTheme(theme) {
      document.documentElement.setAttribute('data-bs-theme', theme);
      localStorage.setItem('theme', theme);
      document.body.className = theme + '-mode';

      const cards = document.querySelectorAll('.card');
      cards.forEach(card => {
        card.classList.remove('light-mode', 'dark-mode');
        card.classList.add(theme + '-mode');
      });

      const toggleBtn = document.getElementById('themeToggle');
      toggleBtn.textContent = theme === 'dark' ? 'â˜€ï¸ Light Mode' : 'ðŸŒ™ Dark Mode';
    }

    function toggleTheme() {
      const current = localStorage.getItem('theme') || 'light';
      const next = current === 'light' ? 'dark' : 'light';
      applyTheme(next);
    }

    document.addEventListener('DOMContentLoaded', () => {
      const theme = localStorage.getItem('theme') || 'light';
      applyTheme(theme);
    });
  </script>
</head>
<body class="light-mode">
  <div class="container py-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
      <h1 class="mb-0">ðŸ“¸ Image Gallery</h1>
      <button id="themeToggle" onclick="toggleTheme()" class="btn btn-outline-secondary btn-sm">
        ðŸŒ™ Dark Mode
      </button>
    </div>

    <!-- Auth Buttons -->
    <div class="mb-3">
      {% if session.get('logged_in') %}
        <a href="{{ url_for('logout') }}" class="btn btn-outline-danger me-2">Logout</a>
        <a href="{{ url_for('upload') }}" class="btn btn-primary">Upload New Image</a>
      {% else %}
        <a href="{{ url_for('login') }}" class="btn btn-outline-primary">Login</a>
      {% endif %}
    </div>

    {% if session.get('logged_in') %}
    <!-- Sort Dropdown -->
    <form method="get" class="mb-3 d-flex align-items-center">
      <label class="me-2">Sort by:</label>
      <select name="sort" class="form-select w-auto me-2" onchange="this.form.submit()">
        <option value="newest" {% if sort == 'newest' %}selected{% endif %}>Newest</option>
        <option value="oldest" {% if sort == 'oldest' %}selected{% endif %}>Oldest</option>
      </select>
      <input type="hidden" name="page" value="1">
    </form>

    <!-- Image Grid -->
    <div class="row">
      {% for image in images %}
      <div class="col-md-3 mb-4 fade-in fade-delay-{{ loop.index % 4 + 1 }}">
        <div class="card shadow-sm position-relative overflow-hidden">
          <a href="{{ url_for('view_image', filename=image) }}">
            <img src="{{ url_for('static', filename='uploads/' + image) }}" class="card-img-top" alt="{{ image }}">
          </a>
          <form action="{{ url_for('delete_image', filename=image) }}" method="post"
                onsubmit="return confirm('Are you sure you want to delete this image?');">
            <button type="submit" class="btn btn-sm btn-danger delete-btn">ðŸ—‘</button>
          </form>
        </div>
      </div>
      {% endfor %}
    </div>

    <!-- Pagination Controls -->
    {% if total_pages > 1 %}
    <nav>
      <ul class="pagination justify-content-center">
        {% if page > 1 %}
        <li class="page-item">
          <a class="page-link" href="{{ url_for('index', page=page-1, sort=sort) }}">Previous</a>
        </li>
        {% endif %}

        {% for p in range(1, total_pages + 1) %}
        <li class="page-item {% if p == page %}active{% endif %}">
          <a class="page-link" href="{{ url_for('index', page=p, sort=sort) }}">{{ p }}</a>
        </li>
        {% endfor %}

        {% if page < total_pages %}
        <li class="page-item">
          <a class="page-link" href="{{ url_for('index', page=page+1, sort=sort) }}">Next</a>
        </li>
        {% endif %}
      </ul>
    </nav>
    {% endif %}
    {% else %}
    <div class="alert alert-warning">
      Please log in to view the gallery.
    </div>
    {% endif %}
  </div>
</body>
</html>
